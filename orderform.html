<section id="order-section" style="max-width: 95%; margin: 30px auto; background: #ffffff; padding: 25px 20px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); font-family: Arial, sans-serif; font-size: 18px;">
  <h2 style="text-align: center; color: #0b8457; font-size: 24px;">ğŸ¥¿ Mwalimu Footwear Order Form</h2>
  <p style="text-align: center; color: #666; font-size: 16px;">Review your cart and complete the details below to place your order.</p>
  
  <form id="orderForm" action="https://formspree.io/f/mdkpqepq" method="POST" style="margin-top: 20px;">
    <!-- Cart Items Will Auto-Appear Here -->
    <div id="cart-items"></div>

    <hr style="margin: 25px 0;">

    <label for="phone" style="display:block; margin-top:15px; color:#444; font-size:17px;">ğŸ“± Phone Number</label>
    <input type="tel" id="phone" name="phone" placeholder="e.g. 0712345678" required style="width:100%; padding:14px; border:1px solid #ccc; border-radius:10px; font-size:17px;">

    <label for="location" style="display:block; margin-top:15px; color:#444; font-size:17px;">ğŸ“ Delivery Location</label>
    <input type="text" id="location" name="location" placeholder="e.g. Mandera Town" required style="width:100%; padding:14px; border:1px solid #ccc; border-radius:10px; font-size:17px;">

    <!-- New Payment Type -->
    <label for="payment" style="display:block; margin-top:15px; color:#444; font-size:17px;">ğŸ’³ Payment Type</label>
    <select id="payment" name="payment_type" required style="width:100%; padding:14px; border:1px solid #ccc; border-radius:10px; background:#fff; font-size:17px;">
      <option value="" disabled selected>Select Payment Type</option>
      <option value="Payment on Delivery">Payment on Delivery</option>
      <option value="Payment Before Delivery">Payment Before Delivery</option>
    </select>

    <label for="message" style="display:block; margin-top:15px; color:#444; font-size:17px;">ğŸ“ Additional Notes</label>
    <textarea id="message" name="message" placeholder="Any special requests?" rows="4" style="width:100%; padding:14px; border:1px solid #ccc; border-radius:10px; font-size:17px;"></textarea>

    <button type="submit" style="margin-top:25px; width:100%; background:#0b8457; color:#fff; padding:15px; border:none; border-radius:10px; font-size:18px; cursor:pointer;">Place Order âœ…</button>
  </form>

  <p id="form-message" style="text-align:center; font-weight:bold; margin-top:20px; font-size:16px;"></p>
</section>

<script>
  const cartContainer = document.getElementById('cart-items');
  const form = document.getElementById('orderForm');
  const message = document.getElementById('form-message');

  const cart = JSON.parse(localStorage.getItem('cart')) || [];

  if (cart.length === 0) {
    cartContainer.innerHTML = "<p style='color:red; text-align:center;'>ğŸ›’ Your cart is empty.</p>";
  } else {
    cart.forEach((item, index) => {
      const div = document.createElement('div');
      div.style.marginBottom = '20px';
      div.style.padding = '12px';
      div.style.border = '1px solid #ddd';
      div.style.borderRadius = '10px';
      div.style.background = '#f9f9f9';
      div.style.fontSize = '17px';
      div.innerHTML = `
        <strong>${item.name}</strong> (x${item.quantity}) - Ksh ${item.price * item.quantity}<br>
        <label style="color:#444;">Shoe Size:</label>
        <input type="text" name="size_${index}" placeholder="e.g. 42" required style="margin-top:8px; padding:10px; width:100%; border:1px solid #ccc; border-radius:8px; font-size:17px;">
        <input type="hidden" name="product_${index}" value="${item.name}">
        <input type="hidden" name="quantity_${index}" value="${item.quantity}">
      `;
      cartContainer.appendChild(div);
    });
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    message.style.color = '#0b8457';
    message.textContent = "Submitting your order...";

    const response = await fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: { 'Accept': 'application/json' }
    });

    if (response.ok) {
      message.style.color = '#0b8457';
      message.textContent = "âœ… Thank you! Your order has been received. We'll contact you soon.";
      form.reset();
      localStorage.removeItem('cart');
    } else {
      message.style.color = 'red';
      message.textContent = "âŒ Something went wrong. Please try again later.";
    }
  });
</script>

<div class="contact-banner" style="text-align:center; margin:30px 0; font-size:17px;">
  ğŸ“ Call: <a href="tel:+254117646714" style="color:#0b8457;">+254117646714</a> &nbsp; | &nbsp;
  <img src="data/images/wicn.jpg" alt="WhatsApp" style="width:22px; vertical-align:middle;"> 
  <a href="https://wa.me/254117646714" target="_blank" style="color:#0b8457;">Chat on WhatsApp</a>
</div>
